{% extends "base.html" %}

{% block head %}
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript" src="https://d3js.org/d3.v3.js"></script>
<script type="text/javascript" src="{{ url_for('static', filename='epoch.min.js') }}"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
{% endblock %}


{% block content %}
<div class='row' style='padding-top:10px'>
    <a href='/' class='btn btn-danger'>Home</a>

    <div class='col-sm-12' style='text-align:center;'>
        <h1>{{ room.title }}</h1> 
    </div>
</div>

<hr>

<div class='row'>
        <div id='chart' class="epoch category10" style="height:200px; width:200px"></div>

    <!-- {% for place in places %}
        {% with place = place %}
            <div class='col-sm-6' id='place-wrapper'>
                <h1 id="live-title">{{ place.name }} connecting...</h1>
                <div id="chart-wrapper col-sm-6">
                    <div id='graph' class="epoch category10" style="height:200px; width:200px"></div>
                    <p>Latest point: </p>
                </div>
            </div>
        {% endwith %}
    {% endfor %} -->

</div>
<hr>
<div class='row'>
    <div class='place-form col-sm-5'>
        
        <img src='{{url_for('static', filename='finder-icon.png')}}' style='padding-top:3px; padding-left:0px; margin-top: 0px; margin-left: -10px; border: 0; height:80px; width:80px;'>

        <form method='POST' action='/place'>
            <input type='hidden' value='{{ room._id }}' name='room_id'>
            {% include "place-form.html" %}
        
                <!-- BUTTON -->
            <div class='form-group col-sm-7'>
                <button class='btn btn-primary btn-block' type='submit'>Add a new target</button>
            </div> 
        </form>
    </div>

    <div class='col-sm-1'>
        <div id='vertical-divider'></div>
    </div>
    

    <div class='col-sm-5'>
        <img src='{{ url_for('static', filename='settings-icon.png') }}' style='height:60px; width:60px; margin-top:15px; margin-left:0px; padding: 0px 0px 4px;'>
        <form method='POST' action='/edit-room'>
            <div class='form-group'>
                <label for='title'>Change Room Title</label>
                <input class='form-control' name='title' type='text' value='{{ room.title }}'> 
            </div>
        </form>
        <form method='POST' action='/delete-room'>
            <input type='hidden' value='{{ room._id }}'>
            <div class='form-group'>
                <button class='btn btn-block btn-danger'>Delete Room</button>
            </div>
        </form>
    </div>
   
</div>


    
{% endblock %}
{% block scripts %}

<script>
    // var charts = new Map()

    // {% for place in places %}
      
            address = btoa( "{{place.name}}" )
            console.log(address)

            var chartData = [
                // The first layer
                {
                    label: "Series",
                    range: "range-l",
                    values: [],
                },
            ];
            
            var chart = $('#chart').epoch({
                type: 'time.line',
                data: chartData,
                axes: ['left', 'bottom']
            });

            // charts.set(address, chart); 
    
    // {% endfor %} 

    // SOCKETS
    // socket.on('connect', function() {
    //     console.log("socket connected")
    //     document.getElementById('live-title').innerHTML = "Connected!";
    // });

    socket.on('point', (data) => {
     
        console.log(data);
        var y = data.y[0]
        console.log(y)

        var newPoint = [{
            label: "Series",
            values: [{ time: data.time, y: y}]
        }]

        console.log(newPoint)
        address = btoa(data.name);
        chart.push(newPoint);
    });

    socket.on('error', function(e) {
        console.log(e);
    });

    socket.on('disconnect', function() {
        console.log("socket disconnected")
        socket.emit('stop', { room_id: "{{ room._id }}" })
    });

    window.onload = function() {
        socket.emit('room', {room_id: "{{room._id}}" })
    };

</script>

{% endblock %}